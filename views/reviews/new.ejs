<!-- views/reviews/new.ejs -->

<% let currentUserReviewed = false; %>
<% let score = undefined; %>
<% let review = {}; %>
<%  for (let creview of reviews) { %> 
  <%  if (currentUser && creview.user.equals(currentUser._id)){ %>
    <% currentUserReviewed = true; %>
    <% review = creview; %>
    <% break; %>  
<% }} %>
<% if (currentUserReviewed) { %>
  <div class="mt-3">
  <small style="padding-left: 4.8em;">Rated</small>
</div>
  <% } else { %>
    <div class="mt-3">
      <small style="padding-left: 2.8em;">Rate the movie</small>
    </div>
 
    <% } %>    
    <form action="<%= currentUserReviewed ? `/reviews/${review._id}?_method=PATCH` : "/reviews" %>" method="post" class=" needs-validation" novalidate> 

    <div class="container">
      <fieldset class="starability-basic">
        <input type="radio" id="no-rate" class="input-no-rate" name="review[score]" value="1" checked aria-label="No rating." />
        <input type="radio" id="first-rate1" name="review[score]" value="1"  <%= review.score == 1 ? "checked" : "" %> onclick="this.form.submit()"/>
        <label for="first-rate1" title="Terrible">1 star</label>
        <input type="radio" id="first-rate2" name="review[score]" value="2"  <%= review.score == 2 ? "checked" : "" %> onclick="this.form.submit()"/>
        <label for="first-rate2" title="Not good">2 stars</label>
        <input type="radio" id="first-rate3" name="review[score]" value="3"  <%= review.score == 3 ? "checked" : "" %> onclick="this.form.submit()"/>
        <label for="first-rate3" title="Average">3 stars</label>
        <input type="radio" id="first-rate4" name="review[score]" value="4"  <%= review.score == 4 ? "checked" : "" %> onclick="this.form.submit()"/>
        <label for="first-rate4" title="Very good">4 stars</label>
        <input type="radio" id="first-rate5" name="review[score]" value="5"  <%= review.score == 5 ? "checked" : "" %> onclick="this.form.submit()"/>
        <label for="first-rate5" title="Amazing">5 stars</label>
      </fieldset>
    </div>
      <input type="text" name="review[movieId]" style="display: none;" value="<%= id %>">
    </form>
    <% if (currentUserReviewed) { %>
      <a href="/reviews/<%= review._id %>/edit"  style="color: black ;padding-left: 3em; text-decoration: none;" ><img src="/img/lapiz.png" alt="pencil"> Review</a>
      <% } %>
 
 



    
      
 


  